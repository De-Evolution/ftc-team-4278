#pragma config(Hubs,  S4, HTMotor,  HTMotor,  HTMotor,  none)
#pragma config(Sensor, S1,     SMUX,           sensorI2CCustom)
#pragma config(Sensor, S2,     sGyr,           sensorI2CHiTechnicGyro)
#pragma config(Sensor, S3,     sAcc,           sensorI2CCustomFastSkipStates)
#pragma config(Sensor, S4,     ,               sensorI2CMuxController)
#pragma config(Motor,  mtr_S4_C1_1,     motorBL,       tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S4_C1_2,     motorFL,       tmotorTetrix, openLoop)
#pragma config(Motor,  mtr_S4_C2_1,     motorAmrL,     tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S4_C2_2,     motorAmrR,     tmotorTetrix, openLoop, reversed, encoder)
#pragma config(Motor,  mtr_S4_C3_1,     motorBR,       tmotorTetrix, openLoop, reversed)
#pragma config(Motor,  mtr_S4_C3_2,     motorFR,       tmotorTetrix, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "AccelGyroDriver.h"
#include "AutoHolonomic.h"
#include "ArmControl.h"

#include "drivers/hitechnic-sensormux.h"
#include "drivers/hitechnic-irseeker-v2.h"
#include "JoystickDriver.c"

#define autoVF1 1
#define autoVF2 2
#define autoVF3 3
#define autoVDF 4
#define autoVB1 5
#define autoVB2 6
#define autoVB3 7

int currentIns = 1;
int currentAuton = 0;

void nextInstruction() {
	currentIns++;
	stopMotors();
	resetAccelGyroData();
	//PlaySound(soundException);
	wait1Msec(250);
	ClearTimer(T2);
}

bool autoF1() {
	switch(currentIns) {
		case 1: return moveToWhite(0, 1, 0.8);
		case 2: if(time1[T2] > 1250) return true; return moveToPos(-0.23, 0, 0.5);
		case 3: return moveToRot(22);
		case 4: if(time1[T2] > 2000) return true; return moveToPos(0, 1, 0.8);
		case 5:
			motor[motorAmrL] = -30;
			motor[motorAmrR] = -30;
			wait1Msec(600);
			motor[motorAmrL] = 0;
			motor[motorAmrR] = 0;
			return true;
		case 6: if(time1[T2] > 2750) return true; return moveToPos(0, -2, .6);
		default:
			return false;
	}
}

bool autoF2() {
	switch(currentIns) {
		case 1: return moveToWhite(0, 1, 0.8);
		case 2: return moveToRot(42);
		case 3: if(time1[T2] > 450) return true; return moveToPos(0, .1, 1);
		case 4:
			motor[motorAmrL] = -30;
			motor[motorAmrR] = -30;
			wait1Msec(475);
			motor[motorAmrL] = 0;
			motor[motorAmrR] = 0;
			return true;
		case 5: if(time1[T2] > 2750) return true; return moveToPos(0, -2, .6);
		default: return false;
	}
}

bool autoF3() {
	switch(currentIns) {
		case 1: return moveToWhite(0, 1, 0.8);
		case 2: if(time1[T2] > 900) return true; return moveToPos(0, -.5, 0.5);
		case 3: return moveToRot(66);
		case 4: if(time1[T2] > 1400) return true; return moveToPos(0,.45,1);
		case 5:
			motor[motorAmrL] = -30;
			motor[motorAmrR] = -30;
			wait1Msec(475);
			motor[motorAmrL] = 0;
			motor[motorAmrR] = 0;
			return true;
		case 6: if(time1[T2] > 2750) return true; return moveToPos(0, -2, .6);
		default:
			return false;
	}
	return false;
}

bool autoDF() {
	switch(currentIns) {
		case 1:
			return false;
		default:
			return false;
	}
}

bool autoB1() {
	switch(currentIns) {
		case 1:
			return false;
		default:
			return false;
	}
}

bool autoB2() {
	switch(currentIns) {
		case 1:
			return false;
		default:
			return false;
	}
}

bool autoB3() {
	switch(currentIns) {
		case 1:
			return false;
		default:
			return false;
	}
}

void AutonomousManager() {
	switch(currentAuton) {
		case autoVF1:
			if(autoF1()) nextInstruction();
			break;
		case autoVF2:
			if(autoF2()) nextInstruction();
			break;
		case autoVF3:
			if(autoF3()) nextInstruction();
			break;
		case autoVDF:
			if(autoDF()) nextInstruction();
			break;
		case autoVB1:
			if(autoB1()) nextInstruction();
			break;
		case autoVB2:
			if(autoB2()) nextInstruction();
			break;
		case autoVB3:
			if(autoB3()) nextInstruction();
			break;
	}
}

void getAutoNumber() {
	currentAuton = autoVF1;
	armLevel = 3;
}

void initializeRobot() {
	hogCPU();
	bDisplayDiagnostics = false;
	initializeAccelGyro();
	PlaySound(soundBeepBeep);

	getAutoNumber();
}

task main() {
	initializeRobot();
	while(true) {
		BackgroundIntegrator();
		AutonomousManager();
		RunArmState();
	}
}
